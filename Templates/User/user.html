<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard-Volusion</title>
    {% load static %}
    <link rel="icon" type="image/x-icon" href="{% static 'images/images/logo1.png' %}" />

    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   
    <link rel="stylesheet" href="{% static 'index.css' %}" />
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link href="{% static 'bootstrap/bootstrap-5.2.2-dist/bootstrap-5.2.2-dist/css/bootstrap.min.css' %}" rel="stylesheet" />
    <script>
      google.charts.load("current", { packages: ["corechart", "line"] });
      google.charts.setOnLoadCallback(drawBackgroundColor);

      function drawBackgroundColor() {
        var data = new google.visualization.DataTable();
        data.addColumn("number", "X");
        data.addColumn("number", "Dogs");

        data.addRows([
          [0, 0],
          [1, 10],
          [2, 23],
          [3, 17],
          [4, 18],
          [5, 9],
          [6, 11],
          [7, 27],
          [8, 33],
          [9, 40],
          [10, 32],
          [11, 35],
          [12, 30],
          [13, 40],
          [14, 42],
          [15, 47],
          [16, 44],
          [17, 48],
          [18, 52],
          [19, 54],
          [20, 42],
          [21, 55],
          [22, 56],
          [23, 57],
          [24, 60],
          [25, 50],
          [26, 52],
          [27, 51],
          [28, 49],
          [29, 53],
          [30, 55],
          [31, 60],
          [32, 61],
          [33, 59],
          [34, 62],
          [35, 65],
          [36, 62],
          [37, 58],
          [38, 55],
          [39, 61],
          [40, 64],
          [41, 65],
          [42, 63],
          [43, 66],
          [44, 67],
          [45, 69],
          [46, 69],
          [47, 70],
          [48, 72],
          [49, 68],
          [50, 66],
          [51, 65],
          [52, 67],
          [53, 70],
          [54, 71],
          [55, 72],
          [56, 73],
          [57, 75],
          [58, 70],
          [59, 68],
          [60, 64],
          [61, 60],
          [62, 65],
          [63, 67],
          [64, 68],
          [65, 69],
          [66, 70],
          [67, 72],
          [68, 75],
          [69, 80],
        ]);

        var options = {
          hAxis: {
            title: "Time",
          },
          yAxis: {
            title: "Popularity",
          },
          backgroundColor: "#f5f5f5",
          title: "Total Payment $1371.00",
        };
        var options1 = {
          hAxis: {
            title: "Time",
          },
          yAxis: {
            title: "Popularity",
          },
          backgroundColor: "#f5f5f5",
          title: "Average Cost $1187.57",
        };
        var options2 = {
          hAxis: {
            title: "Time",
          },
          yAxis: {
            title: "Popularity",
          },
          backgroundColor: "#f5f5f5",
          title: "Total Shipments $10.00",
        };
        var chart = new google.visualization.LineChart(
          document.getElementById("chart_div")
        );
        var chart1 = new google.visualization.LineChart(
          document.getElementById("chart_div1")
        );
        var chart2 = new google.visualization.LineChart(
          document.getElementById("chart_div2")
        );
        chart.draw(data, options);
        chart1.draw(data, options1);
        chart2.draw(data, options2);
      }

      google.charts.load("current", {
        packages: ["geochart"],
      });
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {
        var data = google.visualization.arrayToDataTable([
          ["Country", "Popularity"],
          ["Germany", 200],
          ["United States", 300],
          ["Brazil", 400],
          ["Canada", 500],
          ["France", 600],
          ["RU", 700],
        ]);

        var options = {
          colorAxis: { colors: ["grey", "white"] },
          backgroundColor: "#f5f5f5",
        };

        var gchart = new google.visualization.GeoChart(
          document.getElementById("regions_div")
        );
        gchart.draw(data, options);
      }

      google.charts.load("current", {
        packages: ["geochart"],
      });
      google.charts.setOnLoadCallback(drawRegionsMap1);

      function drawRegionsMap1() {
        var data1 = google.visualization.arrayToDataTable([
          ["Country", "Popularity"],
          ["South America", 600],
          ["Canada", 500],
          ["France", 600],
          ["Russia", 700],
          ["Australia", 600],
        ]);

        var options1 = {
          colorAxis: { colors: ["gray", "white"] },
          backgroundColor: "#f5f5f5",
          // title: "Top International Countries",
        };

        var gchart1 = new google.visualization.GeoChart(
          document.getElementById("regions_div1")
        );
        gchart1.draw(data1, options1);
      }

      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ["Task", "Hours per Day"],
          ["Work", 11],
          ["Eat", 2],
          ["Commute", 2],
          ["Watch TV", 2],
          ["Sleep", 7],
        ]);

        var options = {
          title: "Services",
          backgroundColor: "#f5f5f5",
        };

        var pchart = new google.visualization.PieChart(
          document.getElementById("piechart")
        );

        pchart.draw(data, options);
      }

      document.addEventListener("DOMContentLoaded", function (event2) {
        document.getElementById("nBtn").addEventListener("click", function () {
          document.getElementById("nMenu").style.display = "block";
          event.stopPropagation();
        });
      });
      document.addEventListener("click", function (event2) {
        if (
          nMenu.style.display == "block" &&
          !nMenu.contains(event.target) &&
          event.target !== nBtn
        ) {
          nMenu.style.display = "none";
        }
      });
    </script>
    <style>
       body {
        background-color: #f8f9fa;
      }

      .table {
        border-radius: 10px;
        overflow: hidden;
      }

      .table th,
      .table td {
        vertical-align: middle;
        padding: 15px;
        text-align: left;
      }

      .table thead {
        background-color: #343a40;
        color: white;
      }

      #regions_div,
      #regions_div1 {
      
        width: 100%;
        height: 500px;
      }
      
      .dashboard {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 40px;
        margin-top: 20px;
      }
      .card {
        margin: 0;
        grid-template-columns: repeat(4, 2fr);
      }
      .graphs {
        display: flex;
        flex-direction: row;
        gap: 40px;
        align-content: center;
        width: 100%;
        margin-bottom: 50px;
      }
      .hsearch {
        padding: 0 30px;
        display: flex;
        flex-direction: row;
      }
      .hsearch input {
        margin-right: 500px;
      }
      #chart_div,
      #chart_div1,
      #chart_div2 {
        width: 100%;
        height: 500px;
        max-width: 1100px;
      }
      @media (max-width: 1200px) {
        #chart_div,
        #chart_div1,
        #chart_div2,
        .graph,
        .graphs {
          width: 100%;
          height: 100%;
        }
        main {
          margin-right: 30px;
        }
        #regions_div #regions_div1 {
          width: auto;
          height: auto;
        }
        .dashboard {
          gap: 10px;
          padding-right: 10px;
          
        }
      }
   
      @media (max-width: 768px) {
        main {
          margin-right: 30px;
        }
        .dashboard {
          gap: 10px;
          padding-right: 10px;
        }
        .graph {
          display: flex;
          flex-direction: column;
        }
        .graphs {
          display: flex;
          flex-direction: column;
          margin-bottom: 0px;
          margin-top: 0px;
          gap: -10px;
      
        }
        .graphs .card {
          margin-right: 10px;
          gap:-10px;
          margin-bottom: 10px;
          margin-top: 0px;
          height: auto;
          max-width: 500px;
          width: 100%;
        }
        #chart_div,
        #chart_div1,
        #chart_div2 {
          width: auto;
          height: auto;
        }
        #regions_div,
        #regions_div1 {
          width: 100%;
        }
        .hsearch {
          display: flex;
          flex-direction: column;
        }
        .hsearch input {
          margin-bottom: 10px;
        }
      }

      @media (max-width: 560px) {
        .graphs {
          display: flex;
          flex-direction: column;
          margin-bottom: 20px;
          margin-top: 0px;      
        }
        .graphs .card {
          margin-right: 10px;
          gap:0px;
          margin-bottom: 0px;
          margin-top: 0px;
          height: auto;
          max-width: 350px;
          width: 100%;
        }
        .hsearch {
          display: flex;
          flex-direction: column;
        }
        .hsearch input {
          margin-top: 10px;
        }
        .tableP button lable option {
          margin-bottom: 10px;
          margin-top: 10px;
        }
        #chart_div,
        #chart_div1,
        #chart_div2 {
          width: auto;
          height: 100%;
        }

        .graph,
        #regions_div,
        #regions_div1 {
          width: auto;
          height: 50%;
        }
        .dashboard {
          margin-top: 50px;
          margin-bottom: 0px;
          grid-template-columns: 1fr;
          gap: 2;
        }
        .col-1{
          margin-left: -20px;
        }
      }
      /* Pagination Styles */
      .pagination {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }

      .pagination .page-item.active .page-link {
        background-color: #67e6be;
        border-color: #67e6be;
      }

      .pagination .page-link {
        background-color: white;
        color: black;
        padding: 10px 15px;
        margin: 0 5px;
      }

      .pagination .page-link:hover {
        background-color: #e9ecef;
        color: black;
      }
      .prev{
        background-color: #6c757d !important;
        opacity: 30%;
      }
      .export{
        display: flex;
       width: 300px;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div class="row bigDiv">
      <!-- sidebar -->
      <div
        class="sidebar nav col-5 col-sm-4 col-md-3 col-xl-3 col-xxl-2 col-lg-3"
      >
        <div id="sidebar">
          {% include '../sidebar.html' %}
        </div>
      </div>
      <!-- Header -->
      <div class="col-sm-12 col-md-12 col-lg-9 col-xl-9 col-xxl-10">
        <div class="row">
          <div id="header" class="p-0">
            {% include 'navbar.html' %}
          </div>
        </div>
        <main style="margin: 1rem">
          <div class="mb-4 d-flex justify-content-between align-items-center">
            <h1 class="mb-0">Dashboard</h1>
            <div class="d-flex align-items-center">
              <label class="me-2 mb-0">Today Date:</label>
              <select class="form-select form-select-sm">
                <option>Last 7 Days</option>
                <option>Last 30 Days</option>
                <option>Last 60 Days</option>
                <option>Last 90 Days</option>
              </select>
            </div>
          </div>
          
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card p-3 text-center">
                <h5 class="card-title">Total Spend</h5>
                <p class="card-text">$57.00</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card p-3 text-center">
                <h5 class="card-title">Total Refund</h5>
                <p class="card-text">$20.00</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card p-3 text-center">
                <h5 class="card-title">Referral Balance</h5>
                <p class="card-text">$0.00</p>
              </div>
            </div>
          </div>
          
          <div class="row mt-4">
            <div class="col-md-6 mb-3">
              <div class="card h-100 p-3">
                <h5 class="card-title">Total Shipping Cost</h5>
                <p class="card-text">$76.00</p>
                <a href="#" class="btn btn-dark mt-auto" style="border-radius: 20px;">View Transaction</a>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 p-3">
                <h5 class="card-title">Pending Refund</h5>
                <p class="card-text">$1371.00</p>
                <a href="#" class="btn btn-dark mt-auto" style="border-radius: 20px;">View Refund History</a>
              </div>
            </div>
          </div>
          
          <div class="mt-4">
            <div id="chart_div" class="w-100"></div>
          </div>
          
          <div class="graph" style="margin-top: 50px">
            <div id="chart_div1"></div>
            <div class="graphs" style="margin-left: 0px; margin-top: 30px">
              <div
                class="card"
                style="width: 700px; height: 200px; margin-bottom: 10px"
              >
                Avg. Domestic
                <br />$7.60
                <br />
                <br />
                <a
                  href="#"
                  style="
                    text-decoration: none;
                    border: 1px solid black;
                    color: white;
                    background-color: black;
                    border-radius: 20px;
                  "
                  >View Shipments</a
                >
              </div>
              <div class="card" style="width: 700px; height: 200px">
                Avg. International<br />$0.00 <br />
                <br />
                <a
                  href="#"
                  style="
                    text-decoration: none;
                    border: 1px solid black;
                    color: white;
                    background-color: black;
                    border-radius: 20px;
                  "
                  >View Shipments</a
                >
              </div>
            </div>
          </div>

          <div class="graph" style="margin-top: 50px">
            <div class="graphs" style="margin-right: 20px; margin-top: 30px">
              <div
                class="card"
                style="width: 700px; height: 200px; margin-bottom: 10px"
              >
                New Shipments<br />$0.00 <br />
                <br />
                <a
                  href="#"
                  style="
                    text-decoration: none;
                    border: 1px solid black;
                    color: white;
                    background-color: black;
                    border-radius: 20px;
                  "
                  >View Shipments</a
                >
              </div>
              <div class="card" style="width: 700px; height: 200px">
                Delivery Issues<br />$0.00 <br />
                <a
                  href="#"
                  style="
                    margin-bottom: 20px;
                    margin-top: 10px;
                    text-decoration: none;
                    border: 1px solid black;
                    color: white;
                    background-color: black;
                    border-radius: 20px;
                  "
                  >View Undeliverable Shipments</a
                >
              </div>
            </div>
            <div id="chart_div2"></div>
          </div>

          <div class="graph" style="margin-top: 50px">
            <div>
  <h4>Top States</h4>
  
<div class="table-responsive tableDiv">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>State</th>
        <th>Shipments (%)</th>
        <th>Average Price</th>
      </tr>
    </thead>
    <tbody id="state">
     
      </tr>
    </tbody>
  </table>
</div>

            <div
              id="regions_div"
              style="margin-top: 50px; width: 100%;"
            ></div>
          </div>
          <div class="graph">
            <div>
              <h4>Top International Countries</h4>
              <br />
              <h4>1. United States -</h4>
              <p>100% - shipments - $0.83 avg</p>
            </div>

            <div
              id="regions_div1"
              style="margin-top: 50px; width: 100%;
            "
            ></div>
          </div>

          <div>
            <div
              id="piechart"
              class="graph"
              style="
                margin-top: 50px;
                width: 100%;
                height: 500px;
              "
            ></div>
          </div>
          <div
            style="margin-top: 50px; align-items: center; margin-bottom: 50px"
          >
            <h2 class="mx-4 mb-4">Transaction History</h2>
            <div class="hsearch">
              <input class="form-control" type="search" placeholder="Search" />
              <button class="btn btn-dark export">Export Data</button>
            </div>
            <div class="card mt-5">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Amount</th>
                        <th>Balance</th>
                        <th>Type</th>
                        <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="transections">
                    
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <nav aria-label="Page navigation" class="my-4">
                <ul class="pagination justify-content-end">
                  <li class="page-item">
                    <a class="page-link prev text-white" href="#" tabindex="-1"
                      >Previous</a
                    >
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">1</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">2</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">3</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link bg-black text-white" href="#">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script src="../../static/index.js"></script>
    <script>
      $(document).ready(function () {
        

        fetchtype();
        fetchstatet();

        function fetchtype() {
          $.ajax({
            url: "/api/transactions/",
            method: "GET",
            success: function (response) {
              let tbody = $("#transections");
              tbody.empty();
              response.forEach(function (user) {
                let row = `<tr>
                          <td>${user.amount}</td>
                          <td>${user.balance}</td>
                          <td>${user.type}</td>
                          <td>${user.status}</td>
                          
                         
                        </tr>`;
                tbody.append(row);
              });
            },
            error: function () {
              alert("Failed to retrieve data from the server.");
            },
          });
        }

        function fetchstatet() {
          $.ajax({
            url: "/api/top-states/",
            method: "GET",
            success: function (response) {
              let tbody = $("#state");
              tbody.empty();
              response.forEach(function (user) {
                let row = `<tr>
                          <td>${user.state}</td>
                          <td>${user.shipments_percentage}</td>
                          <td>${user.average_price}</td>
                         
                         
                        </tr>`;
                tbody.append(row);
              });
            },
            error: function () {
              alert("Failed to retrieve data from the server.");
            },
          });
        }

      
       
      });
    </script>
  </body>
</html>